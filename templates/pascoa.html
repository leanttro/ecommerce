<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ loja.nome }} - Especial P√°scoa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family={{ loja.font_titulo }}:wght@400;700&family={{ loja.font_corpo }}:wght@300;400;600&display=swap');
        
        :root { 
            --primary: {{ loja.cor_primaria }}; 
            --color-bg: {{ loja.cor_fundo or '#ffffff' }};
            --color-title: {{ loja.cor_titulo or '#111827' }};
            --color-text: {{ loja.cor_texto or '#374151' }};
            
            --font-head: '{{ loja.font_titulo }}', sans-serif;
            --font-body: '{{ loja.font_corpo }}', sans-serif;
            --font-size-base: {{ loja.font_tamanho_base or 16 }}px;
        }
        
        body { 
            font-family: var(--font-body); 
            font-size: var(--font-size-base);
            color: var(--color-text);
            /* Overlay suave para integrar o tema */
            background-color: var(--color-bg);
            position: relative;
        }
        
        h1, h2, h3, h4, .font-display { 
            font-family: var(--font-head); 
            color: var(--color-title);
        }
        
        .text-theme { color: var(--primary); }
        .bg-theme { background-color: var(--primary); }
        .border-theme { border-color: var(--primary); }
        .hover\:bg-theme:hover { background-color: var(--primary); }
        
        .custom-bg { background-color: rgba(255, 255, 255, 0.85); backdrop-filter: blur(5px); }
        .custom-title-color { color: var(--color-title); }
        
        /* Ticker CSS */
        .ticker-wrap {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            background: var(--primary);
            color: var(--color-bg); 
            height: 35px;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .ticker {
            display: flex;
            align-items: center;
            width: max-content;
            animation: ticker 40s linear infinite;
            padding-left: 0;
        }
        .ticker span {
            display: inline-block;
            padding: 0 40px;
            font-size: 13px;
            font-weight: bold;
            text-transform: uppercase;
        }
        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); } 
        }

        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        /* Anima√ß√£o de Queda - Tema P√°scoa */
        .falling-item {
            position: fixed;
            top: -10%;
            z-index: 0; 
            user-select: none;
            pointer-events: none;
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }
        
        /* Ajuste para garantir que o conte√∫do fique por cima da anima√ß√£o */
        .content-layer { position: relative; z-index: 10; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div class="content-layer">
        {% if loja.frase1 or loja.frase2 or loja.frase3 %}
        <div class="ticker-wrap">
            <div class="ticker">
                {% if loja.frase1 %}<span>üê∞ {{ loja.frase1 }}</span>{% endif %}
                {% if loja.frase2 %}<span>ü•ï {{ loja.frase2 }}</span>{% endif %}
                {% if loja.frase3 %}<span>üç´ {{ loja.frase3 }}</span>{% endif %}
                {% if loja.frase1 %}<span>üê∞ {{ loja.frase1 }}</span>{% endif %}
                {% if loja.frase2 %}<span>ü•ï {{ loja.frase2 }}</span>{% endif %}
                {% if loja.frase3 %}<span>üç´ {{ loja.frase3 }}</span>{% endif %}
                 {% if loja.frase1 %}<span>üê∞ {{ loja.frase1 }}</span>{% endif %}
                {% if loja.frase2 %}<span>ü•ï {{ loja.frase2 }}</span>{% endif %}
                {% if loja.frase3 %}<span>üç´ {{ loja.frase3 }}</span>{% endif %}
                 {% if loja.frase1 %}<span>üê∞ {{ loja.frase1 }}</span>{% endif %}
                {% if loja.frase2 %}<span>ü•ï {{ loja.frase2 }}</span>{% endif %}
                {% if loja.frase3 %}<span>üç´ {{ loja.frase3 }}</span>{% endif %}
            </div>
        </div>
        {% endif %}

        <nav class="sticky top-0 z-40 shadow-sm border-b border-gray-100 transition-colors custom-bg py-4 relative rounded-b-3xl">
            <div class="container mx-auto px-4 min-h-[90px] flex items-center justify-center relative">
                
                <a href="/{{ loja.slug_url }}/" class="flex items-center justify-center z-10 transform -translate-y-2 md:-translate-y-3 hover:scale-105 transition-transform duration-300">
                    {% if loja.logo %}
                        <img src="{{ loja.logo }}" alt="{{ loja.nome }}" class="h-20 md:h-28 w-auto object-contain transition-all">
                    {% else %}
                        <span class="text-3xl font-bold tracking-tight custom-title-color">{{ loja.nome }}</span>
                    {% endif %}
                </a>

                <div class="absolute right-4 flex items-center gap-2 md:gap-4 z-20">
                     <button onclick="toggleMobileMenu()" class="md:hidden p-2 custom-title-color hover:text-pink-500 transition">
                        <i data-lucide="menu" class="w-7 h-7"></i>
                    </button>
                    
                    <button onclick="toggleCart()" class="relative p-2 hover:text-pink-500 transition custom-title-color">
                        <i data-lucide="shopping-bag" class="w-7 h-7"></i>
                        <span id="cart-count-badge" class="absolute top-0 right-0 bg-theme text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold hidden shadow-md">0</span>
                    </button>
                </div>
            </div>
            
            <div class="hidden md:flex justify-center py-3">
                <ul class="flex gap-8 text-sm font-bold uppercase tracking-widest custom-title-color opacity-90">
                    <li><a href="/{{ loja.slug_url }}/" class="hover:text-theme flex items-center gap-1 transition"><i data-lucide="home" class="w-4 h-4"></i> In√≠cio</a></li>
                    <li><a href="#categorias" class="hover:text-theme flex items-center gap-1 transition"><i data-lucide="gift" class="w-4 h-4"></i> Produtos</a></li>
                    <li><a href="#footer" class="hover:text-theme flex items-center gap-1 transition"><i data-lucide="phone" class="w-4 h-4"></i> Contato</a></li>
                </ul>
            </div>

            <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 w-full custom-bg border-t border-gray-100 shadow-xl z-50 rounded-b-3xl">
                <ul class="flex flex-col p-4 space-y-4 font-bold uppercase tracking-widest text-sm custom-title-color text-center">
                    <li><a href="/{{ loja.slug_url }}/" class="block hover:text-theme py-2" onclick="toggleMobileMenu()">In√≠cio</a></li>
                    <li><a href="#categorias" class="block hover:text-theme py-2" onclick="toggleMobileMenu()">Produtos</a></li>
                    <li><a href="#footer" class="block hover:text-theme py-2" onclick="toggleMobileMenu()">Contato</a></li>
                </ul>
            </div>
        </nav>

        {% for secao in layout %}
            
            {% if secao == 'banner' and not loja.ocultar_banner %}
                <section class="slider-container relative w-full h-[350px] md:h-[500px] overflow-hidden rounded-b-[3rem] shadow-sm mb-6">
                    {% if loja.banner1 %}
                    <div class="absolute inset-0">
                        <img src="{{ loja.banner1 }}" class="w-full h-full object-cover">
                        </div>
                    {% endif %}
                </section>
            {% endif %}

            {% if secao == 'busca' and not loja.ocultar_busca %}
                <div class="py-6 custom-bg">
                    <div class="container mx-auto px-4 max-w-xl">
                        <form action="/{{ loja.slug_url }}/" method="GET" class="relative">
                            <i data-lucide="search" class="absolute left-4 top-4 text-pink-400 w-5 h-5"></i>
                            <input type="text" name="busca" placeholder="Busque por ovos, doces, chocolates..." class="w-full p-4 pl-12 rounded-full border-2 border-pink-100 focus:border-theme outline-none shadow-sm transition-all font-medium text-gray-700">
                        </form>
                    </div>
                </div>
            {% endif %}

            {% if secao == 'banners_menores' and not loja.ocultar_banners_menores %}
            <section class="w-full custom-bg py-8">
                <div class="container mx-auto px-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {% if loja.bannermenor1 %}
                        <a href="{{ loja.linkbannermenor1 or '#' }}" class="block overflow-hidden rounded-3xl shadow-md hover:shadow-lg hover:scale-[1.02] transition-all">
                            <img src="{{ loja.bannermenor1 }}" class="w-full h-auto object-cover">
                        </a>
                        {% endif %}
                        {% if loja.bannermenor2 %}
                        <a href="{{ loja.linkbannermenor2 or '#' }}" class="block overflow-hidden rounded-3xl shadow-md hover:shadow-lg hover:scale-[1.02] transition-all">
                            <img src="{{ loja.bannermenor2 }}" class="w-full h-auto object-cover">
                        </a>
                        {% endif %}
                    </div>
                </div>
            </section>
            {% endif %}

            {% if secao == 'categorias' and not loja.ocultar_categorias %}
                <section class="w-full custom-bg py-6" id="categorias">
                    <div class="container mx-auto px-4">
                        <h2 class="text-3xl font-bold mb-6 text-center custom-title-color px-2 flex items-center justify-center gap-2">
                            üå∏ {{ loja.titulo_categorias or 'Nossas Categorias' }} üå∏
                        </h2>
                        <div class="flex gap-4 overflow-x-auto pb-4 justify-center category-scroll hide-scroll">
                            <a href="/{{ loja.slug_url }}/" class="whitespace-nowrap px-8 py-3 rounded-full border-2 border-pink-200 hover:bg-theme hover:text-white hover:border-theme transition-all shadow-sm font-bold bg-white text-gray-700">
                                Todos
                            </a>
                            
                            {% for cat in categorias %}
                            <a href="/{{ loja.slug_url }}/?categoria={{ cat.id }}" class="whitespace-nowrap px-8 py-3 rounded-full border-2 border-pink-100 hover:bg-theme hover:text-white hover:border-theme transition-all shadow-sm font-bold bg-white text-gray-700">
                                {{ cat.nome }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </section>
            {% endif %}

            {% if secao == 'produtos' and not loja.ocultar_produtos %}
                <section class="w-full custom-bg pt-6 pb-16" id="produtos">
                    <div class="container mx-auto px-4 relative">
                        
                        <div class="relative flex justify-center items-center mb-10 px-2">
                            <h2 class="text-3xl font-bold text-center custom-title-color flex items-center gap-2">
                                üê∞ {{ loja.titulo_produtos or 'Especialidades' }} ü•ï
                            </h2>
                            <button onclick="toggleLayout()" class="absolute right-0 p-3 bg-pink-50 rounded-full hover:bg-pink-100 text-pink-600 transition shadow-sm" title="Mudar visualiza√ß√£o">
                                <i id="layout-icon" data-lucide="grid" class="w-5 h-5"></i>
                            </button>
                        </div>

                        <div class="relative group">
                            
                            <button onclick="scrollCarousel(-1)" id="btn-prev" class="absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white p-3 rounded-full shadow-xl hover:bg-pink-50 transition hidden md:flex border border-pink-100 -ml-4">
                                <i data-lucide="chevron-left" class="w-6 h-6 text-pink-600"></i>
                            </button>

                            <div id="products-container" class="flex gap-6 overflow-x-auto snap-x scroll-smooth pb-8 hide-scroll pt-2 px-2">
                                {% for p in produtos %}
                                    <div class="min-w-[170px] w-[170px] md:min-w-[260px] md:w-[260px] flex-none border-2 border-pink-50 rounded-[2rem] overflow-hidden hover:shadow-xl hover:border-pink-200 transition-all bg-white relative snap-start transform hover:-translate-y-2">
                                        {% if p.estoque == 0 %}
                                            <div class="absolute top-3 right-3 bg-red-500 text-white text-[10px] font-bold px-3 py-1.5 rounded-full z-10 shadow-md">
                                                ESGOTADO
                                            </div>
                                        {% endif %}
                                        
                                        <div class="relative p-2">
                                            <a href="/{{ loja.slug_url }}/produto/{{ p.slug }}">
                                                <img src="{{ p.imagem }}" class="w-full aspect-square object-cover rounded-[1.5rem] shadow-sm {{ 'opacity-50' if p.estoque == 0 }}">
                                            </a>
                                            {% if p.estoque > 0 and not p.consulte %}
                                            <button onclick='addToCartPage({{ p | tojson }})' class="absolute bottom-0 right-0 transform translate-x-2 translate-y-2 bg-theme text-white w-12 h-12 rounded-full shadow-lg border-4 border-white hover:scale-110 transition flex items-center justify-center z-20">
                                                <i data-lucide="plus" class="w-6 h-6"></i>
                                            </button>
                                            {% endif %}
                                        </div>

                                        <div class="p-5 text-center"> 
                                            <a href="/{{ loja.slug_url }}/produto/{{ p.slug }}">
                                                <h3 class="font-bold custom-title-color text-sm text-center h-10 flex items-center justify-center line-clamp-2 leading-tight hover:text-theme transition">{{ p.nome }}</h3>
                                            </a>
                                            
                                            {% if p.consulte %}
                                                <p class="text-pink-600 font-black text-lg mt-2 text-center bg-pink-50 rounded-full py-1">Consulte-nos</p>
                                            {% elif p.estoque == 0 %}
                                                <p class="text-gray-400 font-bold text-sm mt-2 text-center">Sem Estoque</p>
                                            {% else %}
                                                <p class="text-theme font-black text-xl mt-2 text-center">R$ {{ "%.2f"|format(p.preco) }}</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="col-span-full text-center text-gray-400 py-10 w-full">
                                        <p>Nenhum produto cadastrado.</p>
                                    </div>
                                {% endfor %}
                            </div>

                            <button onclick="scrollCarousel(1)" id="btn-next" class="absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white p-3 rounded-full shadow-xl hover:bg-pink-50 transition flex border border-pink-100 -mr-4">
                                <i data-lucide="chevron-right" class="w-6 h-6 text-pink-600"></i>
                            </button>
                        </div>
                    </div>
                </section>
            {% endif %}
            
            {% if secao == 'novidades' and novidades and not loja.ocultar_novidades %}
                <section class="py-16 custom-bg">
                    <div class="container mx-auto px-4">
                        <h2 class="text-3xl font-bold mb-10 text-center flex items-center justify-center gap-2">‚≠ê {{ loja.titulo_novidades or 'Lan√ßamentos' }} ‚≠ê</h2>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                             {% for p in novidades %}
                            <div class="border-2 border-pink-50 rounded-3xl overflow-hidden bg-white hover:shadow-xl hover:-translate-y-2 transition-all p-2">
                                <div class="relative">
                                    <a href="/{{ loja.slug_url }}/produto/{{ p.slug }}">
                                        <img src="{{ p.imagem }}" class="w-full aspect-square object-cover rounded-2xl">
                                    </a>
                                    {% if p.estoque > 0 and not p.consulte %}
                                    <button onclick='addToCartPage({{ p | tojson }})' class="absolute bottom-0 right-0 transform translate-x-2 translate-y-2 bg-theme text-white w-10 h-10 rounded-full shadow-lg border-2 border-white hover:scale-110 transition flex items-center justify-center z-20">
                                        <i data-lucide="plus" class="w-5 h-5"></i>
                                    </button>
                                    {% endif %}
                                </div>
                                <div class="p-4 text-center">
                                    <a href="/{{ loja.slug_url }}/produto/{{ p.slug }}">
                                        <h3 class="font-bold custom-title-color text-sm text-center h-10 flex items-center justify-center line-clamp-2 leading-tight hover:text-theme transition">{{ p.nome }}</h3>
                                    </a>
                                    {% if p.consulte %}
                                        <p class="text-pink-600 font-bold text-lg mt-1 text-center bg-pink-50 rounded-full">Consulte</p>
                                    {% else %}
                                        <p class="text-theme font-black text-xl mt-1 text-center">R$ {{ "%.2f"|format(p.preco) }}</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </section>
            {% endif %}

            {% if secao == 'blog' and posts and not loja.ocultar_blog %}
                <section class="py-16 container mx-auto px-4">
                    <h2 class="text-3xl font-bold mb-10 text-center custom-title-color flex items-center justify-center gap-2">üìñ {{ loja.titulo_blog or 'Dicas Fofas' }} üìñ</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        {% for post in posts %}
                        <div class="border-2 border-pink-50 rounded-3xl overflow-hidden shadow-sm hover:shadow-xl transition-all bg-white hover:-translate-y-1">
                            {% if post.capa %}
                            <img src="{{ post.capa }}" class="w-full h-48 object-cover">
                            {% endif %}
                            <div class="p-6">
                                <span class="text-xs font-bold text-pink-400 bg-pink-50 px-3 py-1 rounded-full uppercase">{{ post.data }}</span>
                                <h3 class="font-bold text-xl mt-4 mb-2 text-gray-800">{{ post.titulo }}</h3>
                                <p class="text-sm text-gray-500 line-clamp-3 leading-relaxed">{{ post.resumo }}</p>
                                <a href="/{{ loja.slug_url }}/blog/{{ post.slug }}" class="inline-block mt-4 text-theme font-bold text-sm hover:underline">Ler mais &rarr;</a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
            {% endif %}

        {% endfor %}

        <footer class="text-white py-16 mt-12 rounded-t-[3rem] shadow-[0_-10px_30px_rgba(0,0,0,0.05)] relative z-20" style="background-color: var(--primary);" id="footer">
            <div class="container mx-auto px-4 text-center">
                <h4 class="font-black text-2xl mb-4">{{ loja.nome }}</h4>
                <p class="text-sm mb-8 opacity-90 font-medium">Feito com muito amor e a√ß√∫car! üíñ</p>
                
                <div class="flex justify-center gap-6 text-sm font-bold opacity-80">
                    <a href="#" class="hover:underline hover:opacity-100 transition">Privacidade</a>
                    <a href="#" class="hover:underline hover:opacity-100 transition">Termos</a>
                </div>

                <div class="mt-10 pt-8 border-t border-white/20">
                    <a href="/{{ loja.slug_url }}/admin" class="text-xs font-bold uppercase tracking-widest hover:text-white flex items-center justify-center gap-2 opacity-70 hover:opacity-100 transition">
                        <i data-lucide="lock" class="w-3 h-3"></i> √Årea do Lojista
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <a href="https://wa.me/55{{ loja.whatsapp_comercial }}" target="_blank" 
       class="fixed bottom-6 right-6 z-[70] bg-green-500 hover:bg-green-600 text-white p-4 rounded-full shadow-[0_10px_25px_rgba(34,197,94,0.5)] transition-all hover:scale-110 flex items-center justify-center animate-bounce border-4 border-white">
        <i data-lucide="message-circle" class="w-8 h-8"></i>
    </a>

    <div id="cart-modal" class="fixed inset-0 z-[80] hidden">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity duration-300" onclick="toggleCart()"></div>
        <div class="absolute right-0 top-0 h-full w-full md:w-[450px] bg-white shadow-2xl flex flex-col transform transition-transform duration-300 translate-x-full rounded-l-[2rem] overflow-hidden" id="cart-panel">
            
            <div class="p-6 border-b border-pink-100 flex justify-between items-center bg-pink-50/50">
                <h2 class="font-black text-xl flex items-center gap-2 text-gray-800"><i data-lucide="shopping-bag" class="w-6 h-6 text-theme"></i> Sua Sacola</h2>
                <button onclick="toggleCart()" class="text-gray-400 hover:text-pink-500 bg-white p-2 rounded-full shadow-sm transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6 space-y-6" id="cart-items"></div>

            <div class="p-6 border-t border-pink-100 bg-white space-y-4 shadow-[0_-10px_20px_rgba(0,0,0,0.03)]">
                <div class="flex justify-between items-center text-xl font-black pt-2">
                    <span class="text-gray-600">Total:</span><span id="cart-total" class="text-theme">R$ 0,00</span>
                </div>
                
                <button onclick="finalizarNoZap()" class="w-full bg-green-500 hover:bg-green-600 text-white font-black py-4 rounded-2xl flex items-center justify-center gap-2 shadow-[0_8px_20px_rgba(34,197,94,0.3)] hover:shadow-[0_12px_25px_rgba(34,197,94,0.4)] transition-all active:scale-95 text-lg">
                    <i data-lucide="message-circle" class="w-6 h-6"></i> ENVIAR PEDIDO
                </button>
                <p class="text-xs font-bold text-center text-gray-400">Pagamento combinado no WhatsApp üê∞</p>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        const lojaPhone = "55{{ loja.whatsapp_comercial }}";

        // --- EFEITO P√ÅSCOA (ITENS CAINDO) ---
        function createFallingElements() {
            // Emojis fofos
            const emojis = ['üê∞', 'ü•ö', 'ü•ï', 'üç´', 'üå∏', '‚ú®'];
            for(let i = 0; i < 20; i++) {
                let el = document.createElement('div');
                el.className = 'falling-item text-2xl md:text-3xl opacity-20';
                el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
                // Posi√ß√£o horizontal aleat√≥ria
                el.style.left = Math.random() * 100 + 'vw';
                // Dura√ß√£o da queda aleat√≥ria entre 10s e 25s
                el.style.animationDuration = (Math.random() * 15 + 10) + 's'; 
                // Delay aleat√≥rio para n√£o ca√≠rem juntos
                el.style.animationDelay = (Math.random() * 10) + 's';
                document.body.appendChild(el);
            }
        }
        document.addEventListener('DOMContentLoaded', createFallingElements);


        // --- MENU MOBILE ---
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
            } else {
                menu.classList.add('hidden');
            }
        }

        // --- LAYOUT LISTA/GRADE ---
        let isCarousel = true;
        const container = document.getElementById('products-container');
        const btnPrev = document.getElementById('btn-prev');
        const btnNext = document.getElementById('btn-next');
        const iconLayout = document.getElementById('layout-icon');

        function toggleLayout() {
            isCarousel = !isCarousel;
            if(isCarousel) {
                if(container) container.className = "flex gap-6 overflow-x-auto snap-x scroll-smooth pb-8 hide-scroll pt-2 px-2";
                if(btnPrev) btnPrev.style.display = "flex";
                if(btnNext) btnNext.style.display = "flex";
                if(iconLayout) {
                    iconLayout.innerHTML = '<rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect>'; 
                    lucide.createIcons();
                }
            } else {
                if(container) container.className = "grid grid-cols-2 md:grid-cols-4 gap-6 pt-2 px-2";
                if(btnPrev) btnPrev.style.display = "none";
                if(btnNext) btnNext.style.display = "none";
                if(iconLayout) {
                    iconLayout.innerHTML = '<path d="M8 6h13"></path><path d="M8 12h13"></path><path d="M8 18h13"></path><path d="M3 6h.01"></path><path d="M3 12h.01"></path><path d="M3 18h.01"></path>';
                    lucide.createIcons();
                }
            }
        }

        function scrollCarousel(direction) {
            const scrollAmount = 300; 
            if(container) container.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
        }

        // --- CARRINHO ---
        let cart = []; 
        try { cart = JSON.parse(localStorage.getItem('cart_v2') || '[]'); } catch(e) { cart = []; }

        function saveCart() { localStorage.setItem('cart_v2', JSON.stringify(cart)); updateCartUI(); }

        function toggleCart() {
            const modal = document.getElementById('cart-modal');
            const panel = document.getElementById('cart-panel');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => panel.classList.remove('translate-x-full'), 10);
            } else {
                panel.classList.add('translate-x-full');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function changeQty(idx, delta) {
            if (cart[idx]) {
                cart[idx].qtd += delta;
                if (cart[idx].qtd <= 0) cart.splice(idx, 1);
                saveCart();
            }
        }

        function removeFromCart(idx) { cart.splice(idx, 1); saveCart(); }

        function addToCartPage(product) {
            let final = { ...product };
            final.nome_exibicao = product.nome;
            final.imagem = product.imagem; 
            final.cart_id = `${product.id}-padrao`;

            const idx = cart.findIndex(i => i.cart_id === final.cart_id);
            if (idx > -1) cart[idx].qtd++; else { final.qtd = 1; cart.push(final); }
            
            saveCart();
            toggleCart();
        }

        function updateCartUI() {
            const container = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const countBadge = document.getElementById('cart-count-badge');

            const totalQtd = cart.reduce((acc, i) => acc + i.qtd, 0);
            if(countBadge) {
                countBadge.innerText = totalQtd;
                countBadge.classList.toggle('hidden', totalQtd === 0);
            }

            if(container) {
                container.innerHTML = '';
                let total = 0;
                
                if (cart.length === 0) {
                    container.innerHTML = `<div class="text-center py-12 opacity-50 flex flex-col items-center"><div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4"><i data-lucide="shopping-bag" class="w-8 h-8 text-gray-400"></i></div><p class="font-bold">Sua sacola est√° vazia.</p></div>`;
                }

                cart.forEach((item, i) => {
                    let itemPrice = item.consulte ? 0 : (item.preco || 0);
                    total += itemPrice * item.qtd;
                    
                    let priceDisplay = item.consulte ? "Sob Consulta" : `R$ ${(itemPrice * item.qtd).toFixed(2).replace('.',',')}`;

                    container.innerHTML += `
                        <div class="flex gap-4 border-b border-pink-50 pb-5 last:border-0">
                            <img src="${item.imagem}" class="w-20 h-20 object-cover rounded-2xl bg-gray-100 shadow-sm">
                            <div class="flex-1 min-w-0 flex flex-col justify-center">
                                <h4 class="font-bold text-sm text-gray-800 line-clamp-2 leading-snug mb-2">${item.nome_exibicao}</h4>
                                <div class="flex justify-between items-end mt-auto">
                                    <span class="text-theme font-black text-md">${priceDisplay}</span>
                                    <div class="flex items-center gap-1 bg-pink-50 rounded-xl p-1 border border-pink-100 shadow-sm">
                                        <button onclick="changeQty(${i}, -1)" class="w-6 h-6 flex items-center justify-center text-pink-600 hover:bg-white rounded-lg transition font-bold">-</button>
                                        <span class="text-xs font-bold text-gray-800 w-5 text-center">${item.qtd}</span>
                                        <button onclick="changeQty(${i}, 1)" class="w-6 h-6 flex items-center justify-center text-pink-600 hover:bg-white rounded-lg transition font-bold">+</button>
                                        <div class="w-px h-4 bg-pink-200 mx-1"></div>
                                        <button onclick="removeFromCart(${i})" class="w-6 h-6 flex items-center justify-center text-red-400 hover:text-red-600 hover:bg-white rounded-lg transition"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                });
                if(totalEl) totalEl.innerText = "R$ " + total.toFixed(2).replace('.', ',');
                lucide.createIcons();
            }
        }

        function finalizarNoZap() {
            if (cart.length === 0) return alert("Adicione produtos primeiro!");
            
            let msg = `üê∞ Ol√°! Vim do site e quero fechar meu pedido de P√°scoa:\n\n`;
            let total = 0;
            
            cart.forEach(i => {
                msg += `‚Äî ${i.qtd}x ${i.nome_exibicao}\n`;
                if(i.consulte) {
                     msg += `   (Pre√ßo sob Consulta)\n`;
                } else if(i.preco) {
                    msg += `   R$ ${(i.preco * i.qtd).toFixed(2)}\n`;
                    total += i.preco * i.qtd;
                } else {
                    msg += `   (Sob Consulta)\n`;
                }
            });
            
            msg += `--------------------------------\n`;
            msg += `*üí∞ Total:* R$ ${total.toFixed(2).replace('.', ',')}\n`;
            msg += `\nAguardo as instru√ß√µes de pagamento! ü•ï`;

            const url = `https://wa.me/${lojaPhone}?text=${encodeURIComponent(msg)}`;
            window.open(url, '_blank');
        }

        updateCartUI();
    </script>
</body>
</html>