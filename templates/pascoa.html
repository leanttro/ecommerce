<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ loja.nome }} Especial P√°scoa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@studio-freight/lenis@1.0.39/dist/lenis.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family={{ loja.font_titulo }}:wght@400;700&family={{ loja.font_corpo }}:wght@300;400;600&display=swap');
        
        :root { 
            --primary: {{ loja.cor_primaria }}; 
            --color-bg: {{ loja.cor_fundo or '#fafafa' }};
            --color-title: {{ loja.cor_titulo or '#1d1d1f' }};
            --color-text: {{ loja.cor_texto or '#515154' }};
            
            --font-head: '{{ loja.font_titulo }}', sans-serif;
            --font-body: '{{ loja.font_corpo }}', sans-serif;
            --font-size-base: {{ loja.font_tamanho_base or 16 }}px;
        }
        
        body { 
            font-family: var(--font-body); 
            font-size: var(--font-size-base);
            color: var(--color-text);
            background-color: var(--color-bg);
            position: relative;
            overscroll-behavior: none;
        }
        
        h1, h2, h3, h4, .font-display { 
            font-family: var(--font-head); 
            color: var(--color-title);
            letter-spacing: -0.02em;
        }
        
        .text-theme { color: var(--primary); }
        .bg-theme { background-color: var(--primary); }
        .border-theme { border-color: var(--primary); }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.04);
        }

        /* Anima√ß√µes inspiradas no site do Lando Norris */
        .reveal {
            opacity: 0;
            transform: translateY(30px) scale(0.98);
            transition: all 1.2s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .reveal.active {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        .ticker-wrap {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            background: var(--primary);
            color: #fff; 
            height: 35px;
            display: flex;
            align-items: center;
        }
        .ticker {
            display: flex;
            align-items: center;
            width: max-content;
            animation: ticker 40s linear infinite;
        }
        .ticker span {
            display: inline-block;
            padding: 0 40px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); } 
        }

        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        /* Stickers de P√°scoa com Fade Progressivo */
        .falling-item {
            position: fixed;
            top: -10%;
            z-index: 60; 
            user-select: none;
            pointer-events: none;
            animation: fall linear infinite;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1));
            will-change: transform, opacity;
        }
        @keyframes fall {
            0% { transform: translate(0, -10vh) rotate(0deg) scale(0.7); opacity: 0; }
            15% { opacity: 0.5; }
            50% { transform: translate(40px, 50vh) rotate(180deg) scale(0.9); opacity: 0.3; }
            100% { transform: translate(-40px, 110vh) rotate(360deg) scale(1.1); opacity: 0; }
        }
        
        .content-layer { position: relative; z-index: 10; }

        .card-hover {
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div id="preloader" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-white transition-transform duration-1000 ease-[cubic-bezier(0.7,0,0.3,1)]">
        <div class="animate-bounce text-6xl mb-6">üê∞</div>
        <div class="h-1 w-32 bg-gray-100 rounded-full overflow-hidden">
            <div class="h-full bg-pink-400 w-full animate-pulse rounded-full"></div>
        </div>
    </div>

    <div class="content-layer">
        {% if loja.frase1 or loja.frase2 or loja.frase3 %}
        <div class="ticker-wrap">
            <div class="ticker">
                {% if loja.frase1 %}<span>üê∞ {{ loja.frase1 }}</span>{% endif %}
                {% if loja.frase2 %}<span>ü•ï {{ loja.frase2 }}</span>{% endif %}
                {% if loja.frase3 %}<span>üéÅ {{ loja.frase3 }}</span>{% endif %}
                {% if loja.frase1 %}<span>üê∞ {{ loja.frase1 }}</span>{% endif %}
                {% if loja.frase2 %}<span>ü•ï {{ loja.frase2 }}</span>{% endif %}
                {% if loja.frase3 %}<span>üéÅ {{ loja.frase3 }}</span>{% endif %}
                {% if loja.frase1 %}<span>üê∞ {{ loja.frase1 }}</span>{% endif %}
                {% if loja.frase2 %}<span>ü•ï {{ loja.frase2 }}</span>{% endif %}
                {% if loja.frase3 %}<span>üéÅ {{ loja.frase3 }}</span>{% endif %}
            </div>
        </div>
        {% endif %}

        <nav class="sticky top-0 z-40 glass-panel py-4 transition-all duration-300">
            <div class="container mx-auto px-4 min-h-[70px] flex items-center justify-center relative">
                
                <a href="/{{ loja.slug_url }}/" class="flex items-center justify-center z-10 transform hover:scale-105 transition-transform duration-500 ease-out">
                    {% if loja.logo %}
                        <img src="{{ loja.logo }}" alt="{{ loja.nome }}" class="h-16 md:h-24 w-auto object-contain transition-all drop-shadow-sm">
                    {% else %}
                        <span class="text-3xl font-bold tracking-tight text-[var(--color-title)]">{{ loja.nome }}</span>
                    {% endif %}
                </a>

                <div class="absolute right-4 flex items-center gap-3 z-20">
                     <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-[var(--color-title)] hover:text-pink-500 transition">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    
                    <button onclick="toggleCart()" class="relative p-3 bg-white/50 rounded-full hover:bg-white transition-all shadow-sm border border-gray-100 group text-[var(--color-title)]">
                        <i data-lucide="shopping-bag" class="w-6 h-6 group-hover:scale-110 transition-transform"></i>
                        <span id="cart-count-badge" class="absolute -top-1 -right-1 bg-theme text-white text-[11px] w-5 h-5 flex items-center justify-center rounded-full font-bold hidden shadow-sm">0</span>
                    </button>
                </div>
            </div>
            
            <div class="hidden md:flex justify-center pt-2 pb-1">
                <ul class="flex gap-10 text-xs font-semibold uppercase tracking-widest text-[var(--color-title)] opacity-80">
                    <li><a href="/{{ loja.slug_url }}/" class="hover:text-theme flex items-center gap-2 transition hover:opacity-100"><i data-lucide="home" class="w-3.5 h-3.5"></i> In√≠cio</a></li>
                    <li><a href="#categorias" class="hover:text-theme flex items-center gap-2 transition hover:opacity-100"><i data-lucide="gift" class="w-3.5 h-3.5"></i> Produtos</a></li>
                    <li><a href="#footer" class="hover:text-theme flex items-center gap-2 transition hover:opacity-100"><i data-lucide="phone" class="w-3.5 h-3.5"></i> Contato</a></li>
                </ul>
            </div>

            <div id="mobile-menu" class="hidden absolute top-full left-0 w-full glass-panel border-t border-gray-100 shadow-xl z-50">
                <ul class="flex flex-col p-6 space-y-4 font-semibold uppercase tracking-widest text-sm text-center">
                    <li><a href="/{{ loja.slug_url }}/" class="block hover:text-theme py-2" onclick="toggleMobileMenu()">In√≠cio</a></li>
                    <li><a href="#categorias" class="block hover:text-theme py-2" onclick="toggleMobileMenu()">Produtos</a></li>
                    <li><a href="#footer" class="block hover:text-theme py-2" onclick="toggleMobileMenu()">Contato</a></li>
                </ul>
            </div>
        </nav>

        {% for secao in layout %}
            
            {% if secao == 'banner' and not loja.ocultar_banner %}
                <section class="reveal relative w-full h-[40vh] md:h-[60vh] overflow-hidden mb-12 group" id="hero-carousel">
                    <div class="relative w-full h-full">
                        {% if loja.banner1 %}
                        <div class="hero-slide absolute inset-0 opacity-100 transition-opacity duration-1000 ease-in-out z-10">
                            {% if loja.linkbanner1 %}<a href="{{ loja.linkbanner1 }}" class="w-full h-full block">{% endif %}
                            <img src="{{ loja.banner1 }}" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-[3s] ease-out">
                            <div class="absolute inset-0 bg-gradient-to-t from-[var(--color-bg)] to-transparent opacity-80 pointer-events-none"></div>
                            {% if loja.linkbanner1 %}</a>{% endif %}
                        </div>
                        {% endif %}
                        
                        {% if loja.banner2 %}
                        <div class="hero-slide absolute inset-0 opacity-0 transition-opacity duration-1000 ease-in-out z-0">
                            {% if loja.linkbanner2 %}<a href="{{ loja.linkbanner2 }}" class="w-full h-full block">{% endif %}
                            <img src="{{ loja.banner2 }}" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-[3s] ease-out">
                            <div class="absolute inset-0 bg-gradient-to-t from-[var(--color-bg)] to-transparent opacity-80 pointer-events-none"></div>
                            {% if loja.linkbanner2 %}</a>{% endif %}
                        </div>
                        {% endif %}
                    </div>

                    {% if loja.banner1 and loja.banner2 %}
                    <button onclick="changeHeroSlide(-1)" class="absolute left-4 top-1/2 -translate-y-1/2 z-20 glass-panel p-3 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300 hover:scale-110 shadow-lg">
                        <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--color-title)]"></i>
                    </button>
                    <button onclick="changeHeroSlide(1)" class="absolute right-4 top-1/2 -translate-y-1/2 z-20 glass-panel p-3 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300 hover:scale-110 shadow-lg">
                        <i data-lucide="chevron-right" class="w-6 h-6 text-[var(--color-title)]"></i>
                    </button>
                    
                    <div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-20 flex gap-3">
                        <button onclick="goToHeroSlide(0)" class="hero-dot w-2.5 h-2.5 rounded-full bg-[var(--color-title)] opacity-100 transition-all duration-300 shadow-sm"></button>
                        <button onclick="goToHeroSlide(1)" class="hero-dot w-2.5 h-2.5 rounded-full bg-[var(--color-title)] opacity-40 transition-all duration-300 shadow-sm"></button>
                    </div>
                    {% endif %}
                </section>
            {% endif %}

            {% if secao == 'busca' and not loja.ocultar_busca %}
                <div class="reveal py-4 px-4 relative z-20 -mt-16 md:-mt-24 mb-12">
                    <div class="container mx-auto max-w-2xl">
                        <form action="/{{ loja.slug_url }}/" method="GET" class="relative group">
                            <i data-lucide="search" class="absolute left-6 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5 group-focus-within:text-theme transition-colors"></i>
                            <input type="text" name="busca" placeholder="O que voc√™ est√° procurando hoje?..." class="w-full p-5 pl-14 rounded-full glass-panel focus:outline-none focus:ring-2 focus:ring-pink-200 transition-all font-medium text-gray-700 placeholder-gray-400 text-lg shadow-lg">
                        </form>
                    </div>
                </div>
            {% endif %}

            {% if secao == 'banners_menores' and not loja.ocultar_banners_menores %}
            <section class="reveal w-full py-10">
                <div class="container mx-auto px-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        {% if loja.bannermenor1 %}
                        <a href="{{ loja.linkbannermenor1 or '#' }}" class="block overflow-hidden rounded-[2.5rem] card-hover">
                            <img src="{{ loja.bannermenor1 }}" class="w-full h-full object-cover aspect-[2/1] md:aspect-auto">
                        </a>
                        {% endif %}
                        {% if loja.bannermenor2 %}
                        <a href="{{ loja.linkbannermenor2 or '#' }}" class="block overflow-hidden rounded-[2.5rem] card-hover">
                            <img src="{{ loja.bannermenor2 }}" class="w-full h-full object-cover aspect-[2/1] md:aspect-auto">
                        </a>
                        {% endif %}
                    </div>
                </div>
            </section>
            {% endif %}

            {% if secao == 'categorias' and not loja.ocultar_categorias %}
                <section class="reveal w-full py-12" id="categorias">
                    <div class="container mx-auto px-4">
                        <div class="flex flex-col items-center justify-center mb-10">
                            <span class="text-theme font-bold uppercase tracking-widest text-xs mb-2">Explore</span>
                            <h2 class="text-4xl font-bold text-center text-[var(--color-title)]">Cole√ß√µes</h2>
                        </div>
                        <div class="flex gap-4 overflow-x-auto pb-6 justify-center hide-scroll snap-x">
                            <a href="/{{ loja.slug_url }}/" class="snap-center whitespace-nowrap px-8 py-3.5 rounded-full glass-panel hover:bg-theme hover:text-white transition-all font-semibold text-sm">
                                Ver Tudo
                            </a>
                            {% for cat in categorias %}
                            <a href="/{{ loja.slug_url }}/?categoria={{ cat.id }}" class="snap-center whitespace-nowrap px-8 py-3.5 rounded-full glass-panel hover:bg-theme hover:text-white transition-all font-semibold text-sm">
                                {{ cat.nome }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </section>
            {% endif %}

            {% if secao == 'produtos' and not loja.ocultar_produtos %}
                <section class="reveal w-full pt-8 pb-24" id="produtos">
                    <div class="container mx-auto px-4 relative">
                        
                        <div class="flex justify-between items-end mb-12 px-2 border-b border-gray-200/50 pb-4">
                            <div>
                                <span class="text-theme font-bold uppercase tracking-widest text-xs mb-1 block">Curadoria</span>
                                <h2 class="text-4xl font-bold text-[var(--color-title)]">Em Destaque</h2>
                            </div>
                            <button onclick="toggleLayout()" class="p-3 bg-white/50 rounded-full hover:bg-white transition-colors glass-panel" title="Mudar visualiza√ß√£o">
                                <i id="layout-icon" data-lucide="grid" class="w-5 h-5 text-gray-600"></i>
                            </button>
                        </div>

                        <div class="relative group">
                            
                            <button onclick="scrollCarousel(-1)" id="btn-prev" class="absolute left-0 top-1/2 -translate-y-1/2 z-10 glass-panel p-4 rounded-full hover:scale-110 transition-all hidden md:flex -ml-6">
                                <i data-lucide="chevron-left" class="w-5 h-5 text-gray-800"></i>
                            </button>

                            <div id="products-container" class="flex gap-8 overflow-x-auto snap-x scroll-smooth pb-12 hide-scroll pt-4 px-2">
                                {% for p in produtos %}
                                    <div class="min-w-[200px] w-[200px] md:min-w-[280px] md:w-[280px] flex-none glass-panel rounded-[2.5rem] p-3 card-hover snap-start relative">
                                        {% if p.estoque == 0 %}
                                            <div class="absolute top-6 right-6 bg-black/80 backdrop-blur-md text-white text-[10px] font-bold px-4 py-2 rounded-full z-10 uppercase tracking-wider">
                                                Esgotado
                                            </div>
                                        {% endif %}
                                        
                                        <div class="relative overflow-hidden rounded-[2rem] bg-gray-50 aspect-square">
                                            <a href="/{{ loja.slug_url }}/produto/{{ p.slug }}">
                                                <img src="{{ p.imagem }}" class="w-full h-full object-cover transition-transform duration-700 hover:scale-110 {{ 'opacity-60 grayscale' if p.estoque == 0 }}">
                                            </a>
                                            {% if p.estoque > 0 and not p.consulte %}
                                            <button onclick='addToCartPage({{ p | tojson }})' class="absolute bottom-4 right-4 bg-white text-[var(--color-title)] w-12 h-12 rounded-full shadow-lg hover:bg-theme hover:text-white transition-all duration-300 flex items-center justify-center z-20 group">
                                                <i data-lucide="plus" class="w-5 h-5 group-hover:rotate-90 transition-transform duration-300"></i>
                                            </button>
                                            {% endif %}
                                        </div>

                                        <div class="pt-6 pb-4 px-2 flex flex-col items-center"> 
                                            <a href="/{{ loja.slug_url }}/produto/{{ p.slug }}">
                                                <h3 class="font-semibold text-[var(--color-title)] text-[15px] text-center line-clamp-2 leading-snug hover:text-theme transition-colors">{{ p.nome }}</h3>
                                            </a>
                                            
                                            <div class="mt-4">
                                                {% if p.consulte %}
                                                    <span class="text-xs font-bold uppercase tracking-wider text-gray-500 bg-gray-100 px-4 py-2 rounded-full">Sob Consulta</span>
                                                {% elif p.estoque == 0 %}
                                                    <span class="text-xs font-bold uppercase tracking-wider text-gray-400">Indispon√≠vel</span>
                                                {% else %}
                                                    <span class="text-[var(--color-title)] font-bold text-xl tracking-tight">R$ {{ "%.2f"|format(p.preco) }}</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>

                            <button onclick="scrollCarousel(1)" id="btn-next" class="absolute right-0 top-1/2 -translate-y-1/2 z-10 glass-panel p-4 rounded-full hover:scale-110 transition-all hidden md:flex -mr-6">
                                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-800"></i>
                            </button>
                        </div>
                    </div>
                </section>
            {% endif %}
            
            {% if secao == 'novidades' and novidades and not loja.ocultar_novidades %}
                <section class="reveal py-24 bg-white/40">
                    <div class="container mx-auto px-4">
                        <div class="flex flex-col items-center justify-center mb-16">
                            <span class="text-theme font-bold uppercase tracking-widest text-xs mb-2 block">Acabaram de chegar</span>
                            <h2 class="text-4xl font-bold text-[var(--color-title)]">Lan√ßamentos</h2>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-10">
                             {% for p in novidades %}
                            <div class="glass-panel rounded-[2rem] p-3 card-hover flex flex-col">
                                <div class="relative overflow-hidden rounded-3xl bg-gray-50 aspect-square">
                                    <a href="/{{ loja.slug_url }}/produto/{{ p.slug }}">
                                        <img src="{{ p.imagem }}" class="w-full h-full object-cover transition-transform duration-700 hover:scale-110">
                                    </a>
                                    {% if p.estoque > 0 and not p.consulte %}
                                    <button onclick='addToCartPage({{ p | tojson }})' class="absolute bottom-3 right-3 bg-white/90 backdrop-blur-sm text-gray-900 w-10 h-10 rounded-full shadow-sm hover:bg-theme hover:text-white transition-all flex items-center justify-center z-20">
                                        <i data-lucide="plus" class="w-4 h-4"></i>
                                    </button>
                                    {% endif %}
                                </div>
                                <div class="pt-5 pb-3 px-2 flex-1 flex flex-col justify-between items-center">
                                    <a href="/{{ loja.slug_url }}/produto/{{ p.slug }}">
                                        <h3 class="font-medium text-[var(--color-title)] text-sm text-center line-clamp-2 leading-relaxed">{{ p.nome }}</h3>
                                    </a>
                                    <div class="mt-3">
                                        {% if p.consulte %}
                                            <span class="text-[10px] font-bold uppercase tracking-wider text-gray-500">Consulte</span>
                                        {% else %}
                                            <span class="text-[var(--color-title)] font-semibold text-lg">R$ {{ "%.2f"|format(p.preco) }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </section>
            {% endif %}

            {% if secao == 'blog' and posts and not loja.ocultar_blog %}
                <section class="reveal py-24 container mx-auto px-4">
                    <div class="flex flex-col items-center justify-center mb-16">
                        <span class="text-theme font-bold uppercase tracking-widest text-xs mb-2 block">Novidades</span>
                        <h2 class="text-4xl font-bold text-[var(--color-title)]">Editorial</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                        {% for post in posts %}
                        <div class="glass-panel rounded-[2.5rem] overflow-hidden card-hover group cursor-pointer" onclick="window.location='/{{ loja.slug_url }}/blog/{{ post.slug }}'">
                            {% if post.capa %}
                            <div class="overflow-hidden aspect-[4/3]">
                                <img src="{{ post.capa }}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700">
                            </div>
                            {% endif %}
                            <div class="p-8">
                                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">{{ post.data }}</span>
                                <h3 class="font-bold text-xl mt-3 mb-3 text-[var(--color-title)] leading-tight">{{ post.titulo }}</h3>
                                <p class="text-sm text-gray-500 line-clamp-2 leading-relaxed mb-6">{{ post.resumo }}</p>
                                <span class="text-theme font-semibold text-sm flex items-center gap-2 group-hover:gap-3 transition-all">Ver mais <i data-lucide="arrow-right" class="w-4 h-4"></i></span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
            {% endif %}

        {% endfor %}

        <footer class="text-white py-20 mt-12 relative z-20 overflow-hidden" style="background-color: var(--color-title);" id="footer">
            <div class="container mx-auto px-4 text-center relative z-10">
                <h4 class="font-bold text-3xl mb-6 tracking-tight">{{ loja.nome }}</h4>
                <p class="text-sm mb-10 opacity-70 font-light max-w-md mx-auto">Excel√™ncia e dedica√ß√£o em cada detalhe para voc√™.</p>
                
                <div class="flex justify-center gap-8 text-xs font-semibold uppercase tracking-widest opacity-80 mb-16">
                    <a href="#" class="hover:text-theme transition-colors">Privacidade</a>
                    <a href="#" class="hover:text-theme transition-colors">Termos</a>
                    <a href="#" class="hover:text-theme transition-colors">Social</a>
                </div>

                <div class="pt-8 border-t border-white/10">
                    <a href="/{{ loja.slug_url }}/admin" class="text-[10px] font-bold uppercase tracking-widest flex items-center justify-center gap-2 opacity-40 hover:opacity-100 transition-opacity">
                        <i data-lucide="lock" class="w-3 h-3"></i> Acesso Lojista
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <a href="https://wa.me/55{{ loja.whatsapp_comercial }}" target="_blank" 
       class="fixed bottom-8 right-8 z-[70] bg-black text-white p-5 rounded-full shadow-[0_10px_30px_rgba(0,0,0,0.2)] transition-transform hover:scale-110 flex items-center justify-center">
        <i data-lucide="message-circle" class="w-6 h-6"></i>
    </a>

    <div id="cart-modal" class="fixed inset-0 z-[80] hidden pointer-events-none">
        <div class="absolute inset-0 bg-white/60 backdrop-blur-md transition-opacity duration-500 opacity-0 pointer-events-auto" id="cart-overlay" onclick="toggleCart()"></div>
        <div class="absolute right-0 top-0 h-full w-full md:w-[480px] bg-white/90 backdrop-blur-xl shadow-2xl flex flex-col transform transition-transform duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] translate-x-full rounded-l-[2.5rem] overflow-hidden pointer-events-auto border-l border-white/50" id="cart-panel">
            
            <div class="px-8 py-6 border-b border-gray-100/50 flex justify-between items-center mt-4">
                <h2 class="font-bold text-2xl tracking-tight text-[var(--color-title)]">Sua Sacola</h2>
                <button onclick="toggleCart()" class="text-gray-400 hover:text-black transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-8 space-y-8 hide-scroll" id="cart-items"></div>

            <div class="p-8 bg-gray-50/50 backdrop-blur-md border-t border-gray-100/50">
                <div class="flex justify-between items-end mb-8">
                    <span class="text-sm font-semibold text-gray-500 uppercase tracking-widest">Total Estimado</span>
                    <span id="cart-total" class="text-3xl font-bold text-[var(--color-title)] tracking-tight">R$ 0,00</span>
                </div>
                
                <button onclick="finalizarNoZap()" class="w-full bg-black hover:bg-gray-800 text-white font-semibold py-5 rounded-[1.5rem] flex items-center justify-center gap-3 transition-transform active:scale-95 text-lg shadow-lg">
                    Finalizar Pedido <i data-lucide="arrow-right" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        const lojaPhone = "55{{ loja.whatsapp_comercial }}";

        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('preloader').style.transform = 'translateY(-100%)';
            }, 800);
        });

        const lenis = new Lenis({
            duration: 1.4,
            easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
            smoothWheel: true,
            wheelMultiplier: 0.9,
        });

        function raf(time) {
            lenis.raf(time);
            requestAnimationFrame(raf);
        }
        requestAnimationFrame(raf);

        const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);
        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

        function createFallingElements() {
            const items = ['üê∞', 'ü•ï']; // Apenas coelho e cenoura
            for(let i = 0; i < 10; i++) { // Quantidade reduzida para eleg√¢ncia
                let el = document.createElement('div');
                el.className = 'falling-item text-4xl opacity-0';
                el.innerText = items[Math.floor(Math.random() * items.length)];
                el.style.left = Math.random() * 100 + 'vw';
                el.style.animationDuration = (Math.random() * 25 + 18) + 's'; // Velocidade reduzida
                el.style.animationDelay = (Math.random() * 15) + 's';
                document.body.appendChild(el);
            }
        }
        document.addEventListener('DOMContentLoaded', createFallingElements);

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        let isCarousel = true;
        const container = document.getElementById('products-container');
        const btnPrev = document.getElementById('btn-prev');
        const btnNext = document.getElementById('btn-next');
        const iconLayout = document.getElementById('layout-icon');

        function toggleLayout() {
            isCarousel = !isCarousel;
            if(isCarousel) {
                if(container) container.className = "flex gap-8 overflow-x-auto snap-x scroll-smooth pb-12 hide-scroll pt-4 px-2";
                if(btnPrev) btnPrev.style.display = "flex";
                if(btnNext) btnNext.style.display = "flex";
                if(iconLayout) {
                    iconLayout.innerHTML = '<rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect>'; 
                    lucide.createIcons();
                }
            } else {
                if(container) container.className = "grid grid-cols-2 md:grid-cols-4 gap-6 pt-4 px-2";
                if(btnPrev) btnPrev.style.display = "none";
                if(btnNext) btnNext.style.display = "none";
                if(iconLayout) {
                    iconLayout.innerHTML = '<path d="M8 6h13"></path><path d="M8 12h13"></path><path d="M8 18h13"></path><path d="M3 6h.01"></path><path d="M3 12h.01"></path><path d="M3 18h.01"></path>';
                    lucide.createIcons();
                }
            }
        }

        function scrollCarousel(direction) {
            const scrollAmount = 350; 
            if(container) container.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
        }

        let cart = []; 
        try { cart = JSON.parse(localStorage.getItem('cart_v2') || '[]'); } catch(e) { cart = []; }

        function saveCart() { localStorage.setItem('cart_v2', JSON.stringify(cart)); updateCartUI(); }

        function toggleCart() {
            const modal = document.getElementById('cart-modal');
            const panel = document.getElementById('cart-panel');
            const overlay = document.getElementById('cart-overlay');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    overlay.classList.remove('opacity-0');
                    panel.classList.remove('translate-x-full');
                }, 10);
            } else {
                panel.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 500);
            }
        }

        function changeQty(idx, delta) {
            if (cart[idx]) {
                cart[idx].qtd += delta;
                if (cart[idx].qtd <= 0) cart.splice(idx, 1);
                saveCart();
            }
        }

        function addToCartPage(product) {
            let final = { ...product };
            final.nome_exibicao = product.nome;
            final.imagem = product.imagem; 
            final.cart_id = `${product.id}-padrao`;

            const idx = cart.findIndex(i => i.cart_id === final.cart_id);
            if (idx > -1) cart[idx].qtd++; else { final.qtd = 1; cart.push(final); }
            
            saveCart();
            toggleCart();
        }

        function updateCartUI() {
            const container = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            const countBadge = document.getElementById('cart-count-badge');

            const totalQtd = cart.reduce((acc, i) => acc + i.qtd, 0);
            if(countBadge) {
                countBadge.innerText = totalQtd;
                countBadge.classList.toggle('hidden', totalQtd === 0);
            }

            if(container) {
                container.innerHTML = '';
                let total = 0;
                
                if (cart.length === 0) {
                    container.innerHTML = `<div class="text-center py-20 opacity-40 flex flex-col items-center"><i data-lucide="shopping-bag" class="w-12 h-12 mb-4"></i><p class="font-medium text-lg">Vazio por aqui</p></div>`;
                }

                cart.forEach((item, i) => {
                    let itemPrice = item.consulte ? 0 : (item.preco || 0);
                    total += itemPrice * item.qtd;
                    
                    let priceDisplay = item.consulte ? "Consultar" : `R$ ${(itemPrice * item.qtd).toFixed(2).replace('.',',')}`;

                    container.innerHTML += `
                        <div class="flex gap-6 group">
                            <img src="${item.imagem}" class="w-24 h-24 object-cover rounded-[1.5rem] bg-gray-50">
                            <div class="flex-1 min-w-0 flex flex-col justify-center">
                                <h4 class="font-semibold text-sm text-[var(--color-title)] line-clamp-2 leading-snug mb-3">${item.nome_exibicao}</h4>
                                <div class="flex justify-between items-end mt-auto">
                                    <span class="text-[var(--color-title)] font-bold text-lg tracking-tight">${priceDisplay}</span>
                                    <div class="flex items-center gap-2 bg-gray-50 rounded-full px-2 py-1">
                                        <button onclick="changeQty(${i}, -1)" class="w-7 h-7 flex items-center justify-center text-gray-500 hover:text-black rounded-full transition font-medium">-</button>
                                        <span class="text-xs font-semibold text-gray-800 w-4 text-center">${item.qtd}</span>
                                        <button onclick="changeQty(${i}, 1)" class="w-7 h-7 flex items-center justify-center text-gray-500 hover:text-black rounded-full transition font-medium">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                });
                if(totalEl) totalEl.innerText = "R$ " + total.toFixed(2).replace('.', ',');
                lucide.createIcons();
            }
        }

        function finalizarNoZap() {
            if (cart.length === 0) return alert("Adicione itens √† sacola!");
            let msg = `Ol√°! Tenho interesse nos seguintes itens:\n\n`;
            let total = 0;
            cart.forEach(i => {
                msg += `‚Ä¢ ${i.qtd}x ${i.nome_exibicao}\n`;
                if(!i.consulte && i.preco) total += i.preco * i.qtd;
            });
            msg += `\n*Total:* R$ ${total.toFixed(2).replace('.', ',')}`;
            window.open(`https://wa.me/${lojaPhone}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        updateCartUI();

        let currentHeroSlide = 0;
        const heroSlides = document.querySelectorAll('.hero-slide');
        const heroDots = document.querySelectorAll('.hero-dot');
        let heroInterval;

        function showHeroSlide(index) {
            if (!heroSlides.length) return;
            heroSlides.forEach(slide => {
                slide.classList.remove('opacity-100', 'z-10');
                slide.classList.add('opacity-0', 'z-0');
            });
            heroDots.forEach(dot => dot.classList.replace('opacity-100', 'opacity-40'));
            currentHeroSlide = (index + heroSlides.length) % heroSlides.length;
            heroSlides[currentHeroSlide].classList.replace('opacity-0', 'opacity-100');
            heroSlides[currentHeroSlide].classList.add('z-10');
            heroDots[currentHeroSlide].classList.replace('opacity-40', 'opacity-100');
        }

        function changeHeroSlide(direction) {
            showHeroSlide(currentHeroSlide + direction);
            resetHeroInterval();
        }

        function goToHeroSlide(index) {
            showHeroSlide(index);
            resetHeroInterval();
        }

        function resetHeroInterval() {
            clearInterval(heroInterval);
            if(heroSlides.length > 1) heroInterval = setInterval(() => changeHeroSlide(1), 6000);
        }

        if(heroSlides.length > 1) resetHeroInterval();
    </script>
</body>
</html>